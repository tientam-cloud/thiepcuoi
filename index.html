<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Thiệp Cưới – Tâm & Tiến</title>
    <meta name="description" content="Thiệp cưới online – Tâm & Tiến" />
    <link rel="SHORTCUT ICON" href="/thiepcuoi/img/2021_08_30_bieu-tuong-dam-cuoi-10.jpg" type="image/x-icon" />
    <meta property="og:image" content="/thiepcuoi/img/trap.webp" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
        href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400;1,600&family=Quicksand:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <script defer src="script.js"></script>
</head>

<body>
    <!-- Music (optional) -->
    <audio id="music" src="" preload="none" loop></audio>

    <header class="hero" id="top">
        <!-- Floral wreath (SVG) with parallax -->
        <div class="wreath" aria-hidden="true" data-parallax data-speed="0.15">
            <svg viewBox="0 0 800 800" fill="none" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="petal" x1="0" y1="0" x2="1" y2="1">
                        <stop offset="0%" stop-color="#ffd1dc" />
                        <stop offset="100%" stop-color="#f39cb3" />
                    </linearGradient>
                </defs>
                <g opacity=".9">
                    <circle cx="400" cy="400" r="300" stroke="#ffffff" stroke-opacity=".45" stroke-width="2"
                        stroke-dasharray="6 10" />
                    <g>
                        <path d="M400 110c18 40 18 80 0 120c-18-40-18-80 0-120z" fill="url(#petal)" />
                        <path d="M690 400c-40 18-80 18-120 0c40-18 80-18 120 0z" fill="url(#petal)" />
                        <path d="M400 690c-18-40-18-80 0-120c18 40 18 80 0 120z" fill="url(#petal)" />
                        <path d="M110 400c40-18 80-18 120 0c-40 18-80 18-120 0z" fill="url(#petal)" />
                    </g>
                </g>
            </svg>
        </div>

        <div class="hero-card" data-parallax data-speed="0.08">
            <div class="couple">Tâm & Tiến</div>
            <div class="date">01 • 10 • 2025</div>
            <div class="hero-cta">
                <a href="#countdown" class="btn btn-primary">Xem ngày cưới</a>
                <a href="#gallery" class="btn btn-ghost">Bộ sưu tập ảnh</a>

            </div>
        </div>
        <a class="down" href="#countdown" aria-label="Cuộn xuống">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </a>
    </header>

    <main>
        <!-- Countdown (layout kept, only small hover effect) -->
        <section id="countdown" class="count-hero reveal">
            <div class="count-inner container">
                <div class="flower-wrap" aria-hidden="true">
                    <img class="flower-gif" id="storyFlower-countdown" src="" data-src="/thiepcuoi/img/flower6.gif" alt="" decoding="async" />
                </div>

                <div class="script-line">Ngày hạnh phúc</div>
                <h2 class="count-title">Đếm ngược đến ngày cưới</h2>
                <p class="count-sub">Chúng mình rất mong được đón bạn trong ngày trọng đại ♥</p>

                <div class="count-wrap">
                    <!-- WEDDING CALENDAR -->
                    <figure id="weddingCalendar" class="cal-modern" aria-label="Lịch tháng 10/2025">
                        <div class="cal-title">THÁNG <span id="calMonth">10</span> / <span id="calYear">2025</span>
                        </div>
                        <div class="cal-grid" id="calGrid"></div>
                    </figure>

                    <!-- Countdown row -->
                    <div class="count-row">
                        <div class="time">
                            <div id="dd" class="num">0</div>
                            <div class="lbl">Ngày</div>
                        </div>
                        <div class="time">
                            <div id="hh" class="num">0</div>
                            <div class="lbl">Giờ</div>
                        </div>
                        <div class="time">
                            <div id="mm" class="num">0</div>
                            <div class="lbl">Phút</div>
                        </div>
                        <div class="time">
                            <div id="ss" class="num">0</div>
                            <div class="lbl">Giây</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="sec-transition" aria-hidden="true"></div>


        <section id="story" class="story-alt reveal">
            <div class="container">
                <div class="flower-wrap" aria-hidden="true">
                    <img class="flower-gif" id="storyFlower" src="" data-src="/thiepcuoi/img/flower6.gif" alt="" decoding="async" />
                </div>
                <div class="sec-head">
                    <span class="script-line">Chuyện chúng mình</span>
                    <h2 class="story-title">Từ người lạ thành thương</h2>
                    <div class="story-title-glow"></div>
                </div>
                
                <!-- TAB tiêu đề đè lên ảnh -->
                <article class="story-row" data-anim="lr">
                    <figure class="story-photo">
                        <img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?q=80&w=1600&auto=format&fit=crop" alt="">
                    </figure>
                
                    <div class="story-panel">
                        <time class="p-date">Tháng 2, 2025</time>
                        <h3>Gặp nhau lần đầu</h3>
                        <p>Giữa tiếng nhạc và ánh đèn, tụi mình chạm mắt rồi cười như đã quen từ lâu. Một ly chúc mừng, vài câu chuyện ngắn… và kể từ hôm đó, tên nhau nằm ở đầu danh bạ.</p>
                    </div>
                </article>
                
                <article class="story-row is-rev" data-anim="rl">
                    <div class="story-panel">
                        <time class="p-date">Tháng 3, 2025</time>
                        <h3>Lời tỏ tình</h3>
                        <p>Những cuộc trò chuyện đêm muộn dài hơn, câu “về nhà chưa?” thành thói quen. Một chiều nhiều gió, anh nói “mình hẹn hò nhé?”, em gật đầu. Đơn giản vậy mà tim ấm cả ngày.</p>
                    </div>

                    <figure class="story-photo">
                        <img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?q=80&w=1600&auto=format&fit=crop" alt="">
                    </figure>
                </article>
                
                <article class="story-row" data-anim="lr">
                    <figure class="story-photo">
                        <img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?q=80&w=1600&auto=format&fit=crop" alt="">
                    </figure>
                    <div class="story-panel">
                        <time class="p-date">Tháng 4, 2025</time>
                        <h3>Chuyến đi đầu tiên</h3>
                        <p>Chuyến đi ngắn như cơn gió đầu hạ: lạc vài lần, ăn những món bình thường, chụp những bức ảnh chẳng hoàn hảo nhưng rất vui. Tụi mình hiểu ra: hợp nhau không vì điểm đến, mà vì người đi cùng.</p>
                    </div>
                </article>

                <article class="story-row is-rev" data-anim="rl">
                    <div class="story-panel">
                        <time class="p-date">Tháng 5, 2025</time>
                        <h3>Cầu hôn</h3>
                        <p>Cuối mùa hạ, giữa ánh đèn ấm và vài bản nhạc quen, anh mở chiếc hộp nhỏ, hỏi “làm vợ anh nhé?”. Em gật đầu, mắt ươn ướt. Chiếc nhẫn vừa vặn, còn niềm vui thì tràn ra ngoài bức ảnh. Từ hôm ấy, “anh và em” thành “chúng mình”.</p>
                    </div>

                    <figure class="story-photo">
                        <img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?q=80&w=1600&auto=format&fit=crop" alt="">
                    </figure>
                </article>

                <article class="story-row" data-anim="lr">
                    <figure class="story-photo">
                        <img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?q=80&w=1600&auto=format&fit=crop" alt="">
                    </figure>

                    <div class="story-panel">
                        <time class="p-date">Tháng 10, 2025</time>
                        <h3>Đám cưới</h3>
                        <p>Sau bao ngày mưa nắng, tụi mình chọn “về chung một nhà”. Chiếc nhẫn nhỏ, cái ôm thật chặt và lời hứa dịu dàng: nắm tay nhau đi qua mọi ngày – bình yên cũng là hạnh phúc.</p>
                    </div>
                </article>

            </div>
              
        </section>
          

          
        <!-- Story / About (layout kept) -->
        


        <!-- Events (layout kept, hover added) -->
        <section id="events" class="reveal">
            <div class="container">
                <div class="flower-wrap" aria-hidden="true">
                    <img class="flower-gif" src="/thiepcuoi/img/flower6.gif" alt="" decoding="async" />
                </div>
                
                <!-- <h2 class="section-title">Lịch trình & Địa điểm</h2> -->
                <h2 class="script-line">Lịch trình & Địa điểm</h2>
                <p class="section-sub">Rất hân hạnh được đón tiếp bạn tại buổi lễ của chúng mình</p>
                <div class="events">
                    <div class="event">
                        <div class="cover"
                            style="background-image:url('https://koreamarket.vn/data/tiendo/to/crop1.JPG?q=80&w=1400&auto=format&fit=crop')">
                        </div>
                        <div class="body">
                            <h3>Nhà Gái</h3>
                            <div class="meta">08:30 – 12:00 | 01/10/2025</div>
                            <p>Đình làng vạn nhất, Chương Dương,Thường Tín,Hà Nội</p>
                            <a class="btn btn-ghost" target="_blank"
                                href="https://www.google.com/maps/place/%C4%90%C3%ACnh+L%C3%A0ng/@20.812874,105.9041912,1054m/data=!3m2!1e3!4b1!4m6!3m5!1s0x3135b7430be3bdd7:0x7dcfb203ed1b183a!8m2!3d20.812869!4d105.9067661!16s%2Fg%2F11tsqzt688?entry=ttu&g_ep=EgoyMDI1MDgwNi4wIKXMDSoASAFQAw%3D%3D">Xem
                                bản đồ</a>
                        </div>
                    </div>
                    <div class="event">
                        <div class="cover"
                            style="background-image:url('https://koreamarket.vn/data/tiendo/to/crop2-2.JPG?q=80&w=1400&auto=format&fit=crop')">
                        </div>
                        <div class="body">
                            <h3>Nhà Trai</h3>
                            <div class="meta">08:30 – 21:30 | 01/10/2025</div>
                            <p>Hướng Dương,Thắng Lợi,Thường Tín,Hà Nội,Việt Nam</p>
                            <a class="btn btn-ghost" target="_blank"
                                href="https://www.google.com/maps/place/%C4%90%C3%ACnh+l%C3%A0ng+H%C6%B0%E1%BB%9Bng+D%C6%B0%C6%A1ng/@20.8307694,105.883514,313m/data=!3m1!1e3!4m15!1m8!3m7!1s0x3135b15a674c9bd5:0x595a5b44b72e847!2zSMaw4bubbmcgRMawxqFuZywgVGjhuq9uZyBM4bujaSwgVGjGsOG7nW5nIFTDrW4sIEjDoCBO4buZaSwgVmnhu4d0IE5hbQ!3b1!8m2!3d20.8326242!4d105.8840789!16s%2Fg%2F1hc3mqkqr!3m5!1s0x3135b15a70e32a9b:0xca70270d06234d8d!8m2!3d20.8309433!4d105.8839129!16s%2Fg%2F11gf60ss08?entry=ttu&g_ep=EgoyMDI1MDgwNi4wIKXMDSoASAFQAw%3D%3D">Xem
                                bản đồ</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div class="container">
            <div class="band reveal" data-parallax data-speed="0.04" aria-hidden="true"
                style="background-image:url('https://images.unsplash.com/photo-1460364157752-926555421a7e?q=80&w=1600&auto=format&fit=crop')">
            </div>
        </div>

        <!-- Gallery (layout kept) -->
        <section id="gallery" class="reveal">
            <div class="container">
                <h2 class="section-title">Album ảnh cưới</h2>
                <p class="section-sub">Những khoảnh khắc đáng nhớ</p>
                <div class="gallery">
                    <a class="g-item"
                        data-src="https://koreamarket.vn/data/tiendo/ban/tam_tien8162.jpg?q=80&w=1600&auto=format&fit=crop"><img
                            src="https://koreamarket.vn/data/tiendo/ban/tam_tien8162.jpg" alt="" loading="lazy"
                            decoding="async"></a>
                    <a class="g-item tall"
                        data-src="https://koreamarket.vn/data/tiendo/phu/tam_tien7902.jpg?q=80&w=1600&auto=format&fit=crop"><img
                            src="https://koreamarket.vn/data/tiendo/phu/tam_tien7902.jpg" alt="" loading="lazy"
                            decoding="async"></a>
                    <a class="g-item"
                        data-src="https://koreamarket.vn/data/tiendo/phu/tam tien8162.jpg?q=80&w=1600&auto=format&fit=crop"><img
                            src="https://koreamarket.vn/data/tiendo/phu/tam tien8162.jpg" alt="" loading="lazy"
                            decoding="async"></a>
                    <a class="g-item"
                        data-src="https://koreamarket.vn/data/tiendo/phu/chot/tam tien7871.jpg?q=80&w=1600&auto=format&fit=crop"><img
                            src="https://koreamarket.vn/data/tiendo/phu/chot/tam tien7871.jpg?q=80&w=600&auto=format&fit=crop"
                            alt="" loading="lazy" decoding="async"></a>
                    <a class="g-item tall"
                        data-src="https://koreamarket.vn/data/tiendo/phu/chot/tam tien8401.jpg?q=80&w=1600&auto=format&fit=crop"><img
                            src="https://koreamarket.vn/data/tiendo/phu/chot/tam tien8401.jpg?q=80&w=600&auto=format&fit=crop"
                            alt="" loading="lazy" decoding="async"></a>

                    <a class="g-item"
                        data-src="https://koreamarket.vn/data/tiendo/phu/tam tien8325.jpg?q=80&w=1600&auto=format&fit=crop"><img
                            src="https://koreamarket.vn/data/tiendo/phu/tam tien8325.jpg?q=80&w=600&auto=format&fit=crop"
                            alt="" loading="lazy" decoding="async"></a>

                    <a class="g-item"
                        data-src="https://koreamarket.vn/data/tiendo/phu/chot/tam tien7961.jpg?q=80&w=1600&auto=format&fit=crop"><img
                            src="https://koreamarket.vn/data/tiendo/phu/chot/tam tien7961.jpg?q=80&w=600&auto=format&fit=crop"
                            alt="" loading="lazy" decoding="async"></a>
                    <a class="g-item"
                        data-src="https://koreamarket.vn/data/tiendo/phu/tam tien8132.jpg?q=80&w=1600&auto=format&fit=crop"><img
                            src="https://koreamarket.vn/data/tiendo/phu/tam tien8132.jpg?q=80&w=600&auto=format&fit=crop"
                            alt="" loading="lazy" decoding="async"></a>
                </div>
            </div>
        </section>

        <!-- Gift / QR -->
        <section id="gift" class="reveal">
            <div class="container">
                <h2 class="section-title">Góc quà tặng</h2>
                <p class="section-sub">Lời chúc là món quà quý giá nhất; nếu muốn gửi thêm yêu thương, bạn có thể chuyển
                    khoản
                    qua QR dưới đây. Xin cảm ơn vì đã nghĩ đến chúng mình ♥</p>
                <div class="gift">
                    <div class="bank-card">
                        <div class="b-head">
                            <div class="avatar">👰</div>
                            <div>
                                <div style="font-weight:700">Cô dâu</div>
                                <div class="meta" style="color:var(--muted)">Tâm Jessica</div>
                            </div>
                        </div>
                        <div class="qr-wrap">
                            <a href="#" class="open-lightbox" data-src="https://koreamarket.vn/data/tiendo/qr-tam.jpg"
                                aria-label="Xem QR cô dâu">
                                <img class="qr" data-lazy-gif data-src="https://koreamarket.vn/data/tiendo/qr-tam.jpg"
                                    alt="QR chuyển khoản cô dâu" data-replay="false">
                            </a>
                        </div>
                        <ul class="b-info">
                            <li><strong>Ngân hàng:</strong> VIBank</li>
                            <li><strong>Chủ TK:</strong> Lương Thị Tâm</li>
                            <li><strong>Số TK:</strong> <span>029273178</span>
                                <button type="button" class="copy-btn" data-clipboard="0123456789">Copy</button>
                            </li>
                            <!-- <li><strong>Nội dung gợi ý:</strong> <code>Chuc_mung_dam_cuoi_Tam_Tien_[Ten_ban]</code>
              <button type="button" class="copy-btn" data-clipboard="Chuc_mung_dam_cuoi_Tam_Tien_[Ten_ban]">Copy</button>
          </li> -->
                        </ul>
                    </div>
                    <div class="bank-card">
                        <div class="b-head">
                            <div class="avatar">🤵</div>
                            <div>
                                <div style="font-weight:700">Chú rể</div>
                                <div class="meta" style="color:var(--muted)">Đỗ Tiến</div>
                            </div>
                        </div>
                        <div class="qr-wrap">
                            <a href="#" class="open-lightbox" data-src="https://koreamarket.vn/data/tiendo/qr-tien.jpg"
                                aria-label="Xem QR chú rể">
                                <img class="qr" data-lazy-gif data-src="https://koreamarket.vn/data/tiendo/qr-tien.jpg"
                                    alt="QR chuyển khoản chú rể" data-replay="false">
                            </a>
                        </div>
                        <ul class="b-info">
                            <li><strong>Ngân hàng:</strong> MBBank</li>
                            <li><strong>Chủ TK:</strong>Đỗ Bá Tiến</li>
                            <li><strong>Số TK:</strong> <span>0989269496</span>
                                <button type="button" class="copy-btn" data-clipboard="9876543210">Copy</button>
                            </li>
                            <!-- <li><strong>Nội dung gợi ý:</strong> <code>Gui_tang_yeu_thuong_Tam_Tien_[Ten_ban]</code>
              <button type="button" class="copy-btn" data-clipboard="Gui_tang_yeu_thuong_Tam_Tien_[Ten_ban]">Copy</button>
          </li> -->
                        </ul>
                    </div>
                </div>
                <div class="gift-note card" style="max-width:860px;margin:24px auto 0">
                    <p style="margin:0">“Tình yêu là khi hai trái tim cùng nhìn về một hướng. Cảm ơn bạn đã gửi lời chúc
                        và sẻ
                        chia hạnh phúc cùng chúng mình hôm nay.”</p>
                </div>
            </div>
        </section>

        <!-- RSVP (layout kept) -->
        <section id="rsvp" class="reveal">
            <div class="container rsvp">
                <div class="card">
                    <span class="pill">RSVP</span>
                    <h2 class="section-title" style="text-align:left;margin-top:0">Xác nhận tham dự</h2>
                    <form id="formRSVP">
                        <div class="field"><label>Họ và tên</label><input name="name" required
                                placeholder="Nguyễn Văn A"></div>
                        <div class="field"><label>Số điện thoại</label><input name="phone" required
                                placeholder="090..."></div>
                        <div class="field"><label>Số khách</label>
                            <select name="guests">
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4+</option>
                            </select>
                        </div>
                        <div class="field"><label>Lời nhắn</label><textarea name="msg" rows="4"
                                placeholder="Rất mong được tham dự..."></textarea></div>
                        <button class="btn btn-primary" type="submit">Gửi xác nhận</button>
                    </form>
                    <p id="rsvpMsg" style="margin-top:12px;color:var(--muted)"></p>
                </div>
                <div class="card">
                    <h3 style="margin-top:0;font-family:Playfair Display,serif">Lời cảm ơn</h3>
                    <p>Cảm ơn bạn đã dành thời gian cho chúng mình. Mỗi lời chúc và sự hiện diện của bạn đều vô cùng quý
                        giá. Hẹn
                        gặp bạn trong ngày 01/10/2025!</p>
                    <div
                        style="height:220px;border-radius:14px;background:url('https://images.unsplash.com/photo-1499951360447-b19be8fe80f5?q=80&w=1400&auto=format&fit=crop') center/cover">
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="credits">© 2025 Tâm & Tiến ♥</div>
    </footer>

    <button class="backtop" id="backtop" title="Về đầu trang">↑</button>
    <button id="btnMusic" class="music-toggle" type="button" aria-label="Bật nhạc" aria-pressed="false"
        title="Bật/Tắt nhạc">
        <!-- Speaker ON -->
        <svg class="ic-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" aria-hidden="true">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
        </svg>
        <!-- Speaker OFF -->
        <svg class="ic-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <line x1="22" y1="9" x2="16" y2="15"></line>
            <line x1="16" y1="9" x2="22" y2="15"></line>
        </svg>
    </button>
    <div class="petals" id="petals" aria-hidden="true"></div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Xem ảnh">
        <button class="close" id="closeLightbox">✕</button>
        <img id="lightboxImg" src="" alt="Ảnh phóng to" />
    </div>

    <script>
        // Sử dụng
        lazyGif('#storyFlower-countdown', { replay:true, threshold:0.6 });               
        lazyGif('#storyFlower', { replay:true, threshold:0.6 });  // phát lại mỗi lần thấy

        // Lazy load GIF
        function lazyGif(target, opts = {}) {
            const el = typeof target === 'string' ? document.querySelector(target) : target;
            if (!el) return;

            const dataSrc = el.dataset.src;
            if (!dataSrc) return;

            const replay   = opts.replay ?? (el.dataset.replay === 'true');
            const threshold = opts.threshold ?? 0.55;
            const root      = opts.root ?? null;
            const rootMargin = opts.rootMargin ?? '0px';

            const io = new IntersectionObserver(([entry]) => {
                if (!entry.isIntersecting) return;

                // Lần đầu: load GIF và đánh dấu loaded
                if (!el.dataset.loaded) {
                el.src = dataSrc + '?t=' + Date.now();     // cache-bust để gif chạy từ đầu
                el.addEventListener('load', () => {
                    el.classList.add('loaded');
                    el.dataset.loaded = '1';
                }, { once: true });
                if (!replay) io.unobserve(el);             // chỉ phát 1 lần
                } else if (replay) {
                // Phát lại khi quay lại vùng nhìn
                const fresh = dataSrc + '?t=' + Date.now();
                el.src = '';
                requestAnimationFrame(() => el.src = fresh);
                }
            }, { threshold, root, rootMargin });

            io.observe(el);
            return io;
        }

        // Một observer dùng cho tất cả
        (function initAllLazyGifs(){
            const items = document.querySelectorAll('[data-lazy-gif]');
            if (!items.length) return;

            const io = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                const img = entry.target;
                if (!entry.isIntersecting) return;

                const url = img.dataset.src;
                const replay = img.dataset.replay === 'true';

                if (!img.dataset.loaded) {
                    img.src = url + '?t=' + Date.now();
                    img.addEventListener('load', () => {
                    img.classList.add('loaded');
                    img.dataset.loaded = '1';
                    }, { once:true });
                    if (!replay) io.unobserve(img);
                } else if (replay) {
                    const fresh = url + '?t=' + Date.now();
                    img.src = '';
                    requestAnimationFrame(() => img.src = fresh);
                }
                });
            }, { threshold: 0.55 });

            items.forEach(img => io.observe(img));
        })();



        // ===== CONFIG =====
        const WEDDING_DATE = new Date('2025-10-01T08:00:00+07:00');
        const MUSIC_SRC = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'; // đường dẫn bài nhạc của bạn

        // ===== MUSIC (auto like sample site) =====
        const music = document.getElementById('music');
        const btnMusic = document.getElementById('btnMusic');
        if (btnMusic) {
            let musicOn = false;
            const pref = localStorage.getItem('music_pref');
            function setMusicUI() {
                btnMusic.classList.toggle('on', musicOn);
                btnMusic.setAttribute('aria-pressed', musicOn);
                btnMusic.setAttribute('aria-label', musicOn ? 'Tắt nhạc' : 'Bật nhạc');
            }
            function toast(msg) {
                const t = document.createElement('div');
                t.className = 'music-toast';
                t.textContent = msg; document.body.appendChild(t);
                requestAnimationFrame(() => t.classList.add('show'));
                setTimeout(() => { t.classList.remove('show'); setTimeout(() => t.remove(), 300); }, 1300);
            }
            async function tryPlay() {
                if (!music.src) music.src = MUSIC_SRC; music.loop = true;
                try { await music.play(); musicOn = true; setMusicUI(); localStorage.setItem('music_pref', 'on'); toast('Đang phát nhạc 🎵'); return true; } catch { return false; }
            }
            function armUnlock() {
                const unlock = async () => { if (await tryPlay()) { detach(); } };
                const events = ['click', 'touchstart', 'keydown', 'scroll'];
                function attach() { events.forEach(ev => window.addEventListener(ev, unlock, { once: true, passive: true })); }
                function detach() { events.forEach(ev => window.removeEventListener(ev, unlock, { passive: true })); }
                attach();
            }
            // user toggle
            btnMusic.addEventListener('click', async () => {
                if (!musicOn) { const ok = await tryPlay(); if (!ok) { /* bị chặn */ } }
                else { music.pause(); musicOn = false; setMusicUI(); localStorage.setItem('music_pref', 'off'); toast('Đã tắt nhạc'); }
            });
            // auto behavior giống site mẫu: nếu đã từng bật -> cố gắng phát ngay; nếu không -> kích hoạt khi có tương tác đầu tiên
            if (pref === 'on') { tryPlay().then(ok => { if (!ok) armUnlock(); }); }
            else { setMusicUI(); armUnlock(); }
        }



        // ===== COUNTDOWN =====
        const dd = document.getElementById('dd');
        const hh = document.getElementById('hh');
        const mm = document.getElementById('mm');
        const ss = document.getElementById('ss');
        function tick() {
            const now = new Date();
            let diff = Math.max(0, WEDDING_DATE - now);
            const d = Math.floor(diff / (1000 * 60 * 60 * 24)); diff -= d * 24 * 60 * 60 * 1000;
            const h = Math.floor(diff / (1000 * 60 * 60)); diff -= h * 60 * 60 * 1000;
            const m = Math.floor(diff / (1000 * 60)); diff -= m * 60 * 1000;
            const s = Math.floor(diff / 1000);
            if (dd) { dd.textContent = d }
            if (hh) { hh.textContent = String(h).padStart(2, '0') }
            if (mm) { mm.textContent = String(m).padStart(2, '0') }
            if (ss) { ss.textContent = String(s).padStart(2, '0') }
        }
        tick(); setInterval(tick, 1000);

        // ===== REVEAL ON SCROLL =====
        const io = new IntersectionObserver((entries) => {
            entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('revealed'); io.unobserve(e.target); } });
        }, { threshold: .18 });
        document.querySelectorAll('.reveal').forEach(el => io.observe(el));

        // ===== PARALLAX (disable on mobile to avoid shift) =====
        const parallaxEls = [...document.querySelectorAll('[data-parallax]')];
        const mqMobile = window.matchMedia('(max-width: 768px)');
        function updateParallax() {
            const vh = window.innerHeight;
            parallaxEls.forEach(el => {
                if (mqMobile.matches) { el.style.transform = 'none'; return; }
                const MAX_SHIFT = 80; // px on desktop
                const speed = parseFloat(el.dataset.speed || 0.08);
                const r = el.getBoundingClientRect();
                const progress = (r.top + r.height / 2 - vh / 2) / vh; // -1..1 around center
                let offset = -progress * speed * MAX_SHIFT;
                if (offset > MAX_SHIFT) offset = MAX_SHIFT;
                if (offset < -MAX_SHIFT) offset = -MAX_SHIFT;
                el.style.transform = `translateY(${offset}px)`;
            });
        }
        window.addEventListener('scroll', updateParallax, { passive: true });
        window.addEventListener('resize', updateParallax);
        updateParallax();

        // ===== PETALS RAIN (global overlay) =====
        const petalsWrap = document.getElementById('petals');
        let petalTimer; const MAX_PETALS = 80;
        function spawnPetal() {
            if (!petalsWrap) return;
            if (petalsWrap.childElementCount > MAX_PETALS) {
                petalsWrap.firstElementChild?.remove();
            }
            const s = 10 + Math.random() * 14; // 10-24px
            const p = document.createElement('span');
            p.className = 'petal';
            p.style.left = Math.random() * 100 + 'vw';
            p.style.width = s + 'px';
            p.style.height = (s * 0.75) + 'px';
            p.style.setProperty('--dur', (9 + Math.random() * 9) + 's');
            p.style.setProperty('--dx', (Math.random() * 60 - 30) + 'vw');
            p.style.setProperty('--rot', (Math.random() * 360) + 'deg');
            petalsWrap.appendChild(p);
            setTimeout(() => p.remove(), 22000);
        }
        function startPetals() {
            if (petalTimer) return;
            for (let i = 0; i < 20; i++) setTimeout(spawnPetal, i * 120);
            petalTimer = setInterval(spawnPetal, 700);
        }
        function stopPetals() { clearInterval(petalTimer); petalTimer = null; }

        document.addEventListener('visibilitychange', () => { if (document.hidden) stopPetals(); else startPetals(); });
        startPetals();

        // ===== LIGHTBOX =====
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        const closeLightbox = document.getElementById('closeLightbox');
        document.querySelectorAll('.g-item, .open-lightbox').forEach(a => {
            a.addEventListener('click', (e) => {
                e.preventDefault();
                lightboxImg.src = a.dataset.src || a.querySelector('img').src;
                lightbox.classList.add('open');
            });
        });
        if (closeLightbox) { closeLightbox.addEventListener('click', () => lightbox.classList.remove('open')); }
        lightbox?.addEventListener('click', (e) => { if (e.target === lightbox) lightbox.classList.remove('open'); });

        // ===== COPY TO CLIPBOARD (gift) =====
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(btn.dataset.clipboard || '');
                    const t = btn.textContent; btn.textContent = 'Đã copy';
                    setTimeout(() => btn.textContent = t, 1200);
                } catch (e) { console.log(e); }
            });
        });

        // ===== BACK TO TOP =====
        // const backtop = document.getElementById('backtop');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 600) backtop.classList.add('show'); else backtop.classList.remove('show');
        });
        // backtop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

        // Cuộn mượt với thời gian tùy chỉnh
        function smoothScrollToTop(duration = 1500) {
            const start = window.scrollY;
            const startTime = performance.now();

            function scrollStep(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1); // 0 -> 1

                // easing: easeInOutQuad
                const ease = progress < 0.5
                    ? 2 * progress * progress
                    : -1 + (4 - 2 * progress) * progress;

                window.scrollTo(0, start - (start * ease));

                if (progress < 1) {
                    requestAnimationFrame(scrollStep);
                }
            }

            requestAnimationFrame(scrollStep);
        }

        backtop.addEventListener('click', () => smoothScrollToTop(1500)); // 1500ms = 1.5s


        // ===== SIMPLE RSVP (demo) =====
        const form = document.getElementById('formRSVP');
        if (form) {
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const data = Object.fromEntries(new FormData(this));
                console.log('RSVP:', data);
                document.getElementById('rsvpMsg').textContent = 'Cảm ơn bạn! Chúng mình đã nhận được xác nhận.';
                this.reset();
            });
        }

        // Cuộn mượt đến section với thời gian tùy chỉnh
        function smoothScrollTo(targetSelector, duration = 500) {
            const target = document.querySelector(targetSelector);
            if (!target) return;

            const start = window.scrollY;
            const end = target.getBoundingClientRect().top + window.scrollY;
            const startTime = performance.now();

            function step(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Easing: easeInOutQuad
                const ease = progress < 0.5
                    ? 2 * progress * progress
                    : -1 + (4 - 2 * progress) * progress;

                window.scrollTo(0, start + (end - start) * ease);

                if (progress < 1) requestAnimationFrame(step);
            }

            requestAnimationFrame(step);
        }

        // Áp dụng cho tất cả các link cuộn trong trang
        document.querySelectorAll('a[href^="#"]').forEach(link => {
            link.addEventListener('click', function (e) {
                const targetId = this.getAttribute('href');
                if (targetId.length > 1) { // bỏ qua nếu chỉ là '#'
                    e.preventDefault();
                    smoothScrollTo(targetId, 500); // 1.2 giây
                }
            });
        });

    </script>
</body>

</html>